import{BREAKPOINTS,debounce}from"utils";class ItemsScroll extends HTMLElement{items;scrollBar;scrollBarTrack;navigationContainer;navigationPrevButton;navigationNextButton;pageNavigationContainer;#t;#i;#e;#n;#a;#s;#o;#r;#l;#h;#g;#c;#v;#u;#d;#m;static observedAttributes=["scroll-enabled"];constructor(){super(),this.items=this.querySelector("[data-items]"),this.pageNavigationContainer=null,this.breakpointMin=Object.keys(BREAKPOINTS).includes(this.getAttribute("breakpoint-min"))?BREAKPOINTS[this.getAttribute("breakpoint-min")]:Number(this.getAttribute("breakpoint-min")||"0"),this.breakpointMax=Object.keys(BREAKPOINTS).includes(this.getAttribute("breakpoint-max"))?BREAKPOINTS[this.getAttribute("breakpoint-max")]:Number(this.getAttribute("breakpoint-max")||"Infinity"),this.pageNavigationWrapper=null,this.navigationContainer=null,this.navigationPrevButton=null,this.navigationNextButton=null,this.navigationCounterOnly=this.hasAttribute("mobile-counter-only"),this.navigationCounterSeparator="/",this.navigationCounterShowForPagesAmount=7,this.navigationCounterShowUpToContainerSize=768,this.pageNavigationDisabled=this.hasAttribute("page-navigation-disabled"),this.snap=this.getAttribute("snap"),this.#t=!1,this.#e=null,this.#n=null,this.#l=null,this.#h=null,this.#g=!1,this.#c=0,this.#r=!1,this.#v=null,this.#u=null,this.#d=null}connectedCallback(){if(!this.items)throw Error("Items container missing");this.#c=this.items.scrollLeft,this.#d=new ResizeObserver(debounce((()=>{this.#b()})),50),this.#d.observe(this.items),this.#v||this.#p(),this.#u||this.#N(),this.#m=this.getAttribute("image-container-ratio"),this.#C(),this.items.addEventListener("scrollend",(()=>{const t=this.items.scrollLeft,i=t>this.#c?"FORWARD":"BACKWARD";this.dispatchEvent(new CustomEvent("on:items-scroll:scroll",{detail:{direction:i,position:t}})),this.#c=t}))}disconnectedCallback(){this.#v&&(this.#v.disconnect(),this.#v=null),this.#u&&(this.#u.disconnect(),this.#u=null),this.#d&&(this.#d.disconnect(),this.#d=null)}attributeChangedCallback(t,i,e){"scroll-enabled"===t&&i!==e&&this.dispatchEvent(new CustomEvent("on:items-scroll:change-state",{detail:{scrollable:this.hasAttribute("scroll-enabled")}}))}#f(){const t=window.getComputedStyle(this.items),i=Number(t.getPropertyValue("column-gap").replace("px","")),e=window.getComputedStyle(this.items.firstElementChild),n=Number(e.getPropertyValue("margin-left").replace("px","")),a=Number(e.getPropertyValue("margin-right").replace("px",""));return Array.from(this.items.children)[Math.round(this.items.scrollLeft/(n+this.items.firstElementChild.getBoundingClientRect().width+a+i))]}#P(){this.pageNavigationDisabled||this.#t||(window.requestAnimationFrame((()=>{this.#C(),this.#t=!1})),this.#t=!0)}#A(){if(this.pageNavigationDisabled)return;this.pageNavigationWrapper||(this.pageNavigationWrapper=document.createElement("div"),this.pageNavigationWrapper.classList.add("page-navigation-wrapper"),this.appendChild(this.pageNavigationWrapper));const t=Math.ceil(this.items.children.length/this.#a);t!==this.#s&&(this.#s=t,this.navigationCounterShowUpToContainerSize&&this.navigationCounterShowUpToContainerSize>=this.offsetWidth&&this.navigationCounterShowForPagesAmount&&(this.navigationCounterOnly||this.#s>=this.navigationCounterShowForPagesAmount)?(this.pageNavigationContainer&&this.pageNavigationContainer.setAttribute("hidden",!0),this.pageNavigationCounter||(this.pageNavigationCounter=document.createElement("div"),this.pageNavigationCounter.classList.add("page-navigation-counter"),this.pageNavigationWrapper.appendChild(this.pageNavigationCounter)),this.pageNavigationCounter.removeAttribute("hidden"),this.pageNavigationCounter.innerHTML=`\n          <span class="page-navigation-counter__current">${this.#o||1}</span>\n          <span class="page-navigation-counter__separator">${this.navigationCounterSeparator}</span>\n          <span class="page-navigation-counter__total">${this.#s}</span>\n        `,this.#C()):(this.pageNavigationCounter&&this.pageNavigationCounter.setAttribute("hidden",!0),this.pageNavigationContainer||(this.pageNavigationContainer=document.createElement("ul"),this.pageNavigationContainer.classList.add("page-navigation"),this.pageNavigationContainer.setAttribute("role","tablist"),this.pageNavigationWrapper.appendChild(this.pageNavigationContainer)),this.pageNavigationContainer.removeAttribute("hidden"),this.#s>1?(this.pageNavigationContainer.innerHTML=`\n            ${Array.from({length:t},((t,i)=>`\n              <li class="page-navigation__item" role="presentation">\n                <button type="button" role="tab" class="page-navigation__button" data-page="${i+1}" aria-label="Scroll to page ${i+1} of ${this.#s}" tabindex="-1">\n                  <span class="visually-hidden">${i+1}</span>\n                </button>\n              </li>\n            `)).join("\n")}\n          `,this.#C()):this.pageNavigationContainer.innerHTML=""))}#S(t){const{target:i}=t;if(!i.classList.contains("page-navigation__button"))return;const e=Number(i.dataset.page);this.#L(this.items.children[this.#a*(e-1)].offsetLeft,"smooth")}#E(){const t=document.createElement("div");t.classList.add("navigation"),t.innerHTML='\n      <button type="button" class="navigation__button navigation__button--prev" data-navigation-prev aria-label="Previous page"></button>\n      <button type="button" class="navigation__button navigation__button--next" data-navigation-next aria-label="Next page"></button>\n    ',this.appendChild(t),this.navigationContainer=t,this.navigationPrevButton=t.querySelector("[data-navigation-prev]"),this.navigationNextButton=t.querySelector("[data-navigation-next]");const i=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;i.classList.add("icon--left"),this.navigationPrevButton.append(i);const e=document.getElementById("template-icon-chevron").content.cloneNode(!0).firstElementChild;this.navigationNextButton.append(e)}#O(t){if(t.preventDefault(),this.#g)return;const i=this.#f().previousElementSibling;i&&(this.#g=!0,this.classList.add("is-scrolling"),this.smoothScrollItems(i.offsetLeft).finally((()=>{this.#g=!1,this.classList.remove("is-scrolling")})))}#y(t){if(t.preventDefault(),this.#g)return;const i=this.#f().nextElementSibling;i&&(this.#g=!0,this.classList.add("is-scrolling"),this.smoothScrollItems(i.offsetLeft).finally((()=>{this.#g=!1,this.classList.remove("is-scrolling")})))}#x(){this.#r||(this.#e=this.#P.bind(this),this.#n=this.#S.bind(this),this.#l=this.#O.bind(this),this.#h=this.#y.bind(this),this.items.addEventListener("scroll",this.#e),this.pageNavigationContainer&&this.pageNavigationContainer.addEventListener("click",this.#S.bind(this)),this.navigationPrevButton.addEventListener("click",this.#l),this.navigationNextButton.addEventListener("click",this.#h),this.#r=!0)}#I(){this.#r&&(this.items.removeEventListener("scroll",this.#e),this.pageNavigationContainer&&this.pageNavigationContainer.removeEventListener("click",this.#n),this.navigationPrevButton.removeEventListener("click",this.#l),this.navigationNextButton.removeEventListener("click",this.#h),this.#r=!1)}#b(){const t=(t,i)=>{const[e,n]=t.split(":").map((t=>Number(t))),a=Number(window.getComputedStyle(this.items).getPropertyValue("column-gap").replace("px","")||0),s=(t,i)=>i?s(i,t%i):t,o=s(n,Math.round(this.items.offsetHeight));return`${e*i*Math.round(this.items.offsetHeight)/o+a*(i-1)*n/o} / ${n*Math.round(this.items.offsetHeight)/o}`};if(this.items.children.length>0){const t=Math.floor(this.items.offsetWidth/this.items.children[0].offsetWidth);this.#a=t}document.body.offsetWidth>this.breakpointMin&&document.body.offsetWidth<=this.breakpointMax?this.setAttribute("scroll-enabled",""):this.removeAttribute("scroll-enabled"),this.hasAttribute("scroll-enabled")&&this.items.scrollWidth>this.items.offsetWidth+10?(this.setAttribute("scrollable",""),this.navigationContainer||this.#E(),this.#A(),this.snap||(this.items.children.length>0&&this.items.children[0].offsetWidth>this.items.offsetWidth/2?this.setAttribute("snap","center"):this.setAttribute("snap","start")),this.#x()):(this.navigationContainer&&this.pageNavigationContainer&&this.#I(),this.removeAttribute("scrollable","")),this.#m&&"natural"!==this.#m.toLowerCase()&&this.style.setProperty("--navigation-ratio",t(this.#m,this.#a)),this.items.classList.contains("grid-layout")&&(this.items.children.length<this.#a?this.items.classList.add("grid-layout--align-center"):this.items.classList.remove("grid-layout--align-center"))}#C(){if(this.pageNavigationDisabled)return;if(!this.#s||!this.#s>1)return;const t=this.#f(),i=[...this.items.children].indexOf(t);this.#o=i;const e=this.#o+this.#a>this.items.children.length-1?this.#s-1:Math.floor(i/this.#a);if(this.pageNavigationContainer&&(this.pageNavigationContainer.querySelector(".is-active")&&this.pageNavigationContainer.querySelector(".is-active").classList.remove("is-active"),this.pageNavigationContainer.children[e]&&this.pageNavigationContainer.children[e].querySelector("button").classList.add("is-active")),this.pageNavigationCounter){const t=this.pageNavigationCounter.querySelector(".page-navigation-counter__current");this.pageNavigationCounter.setAttribute("aria-label",`Page ${e+1} of ${this.#s}`),t&&(t.innerHTML=e+1)}}#N(){this.#u=new MutationObserver((t=>{t.forEach((t=>{"childList"===t.type&&(this.#b(),this.#p())}))})),this.#u.observe(this.items,{attributes:!1,childList:!0,subtree:!1})}#p(){if(!this.items.firstElementChild)return;const t={root:this.items,rootMargin:"0px",threshold:.75};this.#v&&this.#v.disconnect(),this.#v=new IntersectionObserver((t=>{this.navigationContainer&&t.forEach((({target:t,isIntersecting:i})=>{t.previousElementSibling||(this.navigationPrevButton.disabled=i),t.nextElementSibling||(this.navigationNextButton.disabled=i)}))}),t),this.#v.observe(this.items.firstElementChild),this.#v.observe(this.items.lastElementChild)}#L(t,i="instant"){let e=t;e<0?e=0:e>this.items.scrollWidth-this.items.offsetWidth&&(e=this.items.scrollWidth-this.items.offsetWidth),"instant"===i?this.items.scrollTo({behavior:"instant",left:e}):(this.#g=!0,this.classList.add("is-scrolling"),this.smoothScrollItems(e).finally((()=>{this.#g=!1,this.classList.remove("is-scrolling")})))}smoothScrollItems(t){return new Promise(((i,e)=>{let n=0,a=null;const s=()=>{const o=this.items.scrollLeft;if(this.#i)return e(o);if(o===a){if(n+=1,n>2)return i(t)}else n=0,a=o;return window.requestAnimationFrame(s),null};this.items.scrollTo({left:t,behavior:window.matchMedia("(prefers-reduced-motion: reduce)").matches?"instant":"smooth"}),window.requestAnimationFrame(s)}))}}customElements.define("items-scroll",ItemsScroll);
//# sourceMappingURL=items-scroll.js.map
